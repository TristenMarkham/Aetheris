{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useBusinessData.js\nimport { useState, useEffect, useCallback } from 'react';\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:3000';\nexport const useBusinessData = () => {\n  _s();\n  var _businessData$clients;\n  const [businessData, setBusinessData] = useState({\n    employees: [],\n    // 🔧 FIX: Default to empty array\n    clients: [],\n    // 🔧 FIX: Default to empty array\n    sites: [],\n    // 🔧 FIX: Default to empty array\n    companyInfo: {},\n    platformModules: [],\n    realTimeMetrics: {}\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // 🔧 SAFE: Helper function to ensure arrays exist\n  const safeArrayFilter = (array, filterFn) => {\n    return Array.isArray(array) ? array.filter(filterFn) : [];\n  };\n  const fetchBusinessData = useCallback(async () => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const response = await fetch(`${API_BASE}/api/business-data`);\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      const result = await response.json();\n      if (result.success) {\n        var _result$data, _result$data2, _result$data3, _result$data4, _result$data5, _result$data6;\n        // 🔧 SAFE: Ensure all arrays exist with fallbacks\n        const safeData = {\n          employees: Array.isArray((_result$data = result.data) === null || _result$data === void 0 ? void 0 : _result$data.employees) ? result.data.employees : [],\n          clients: Array.isArray((_result$data2 = result.data) === null || _result$data2 === void 0 ? void 0 : _result$data2.clients) ? result.data.clients : [],\n          sites: Array.isArray((_result$data3 = result.data) === null || _result$data3 === void 0 ? void 0 : _result$data3.sites) ? result.data.sites : [],\n          companyInfo: ((_result$data4 = result.data) === null || _result$data4 === void 0 ? void 0 : _result$data4.companyInfo) || {},\n          platformModules: Array.isArray((_result$data5 = result.data) === null || _result$data5 === void 0 ? void 0 : _result$data5.platformModules) ? result.data.platformModules : [],\n          realTimeMetrics: ((_result$data6 = result.data) === null || _result$data6 === void 0 ? void 0 : _result$data6.realTimeMetrics) || {},\n          summary: result.summary || {}\n        };\n        setBusinessData(safeData);\n        console.log('✅ Business data loaded safely:', {\n          employees: safeData.employees.length,\n          clients: safeData.clients.length,\n          sites: safeData.sites.length\n        });\n      } else {\n        throw new Error(result.error || 'Failed to fetch business data');\n      }\n    } catch (err) {\n      console.error('❌ Business data fetch error:', err);\n      setError(err.message);\n      // 🔧 SAFE: Keep existing data structure even on error\n      setBusinessData(prev => ({\n        employees: Array.isArray(prev.employees) ? prev.employees : [],\n        clients: Array.isArray(prev.clients) ? prev.clients : [],\n        sites: Array.isArray(prev.sites) ? prev.sites : [],\n        companyInfo: prev.companyInfo || {},\n        platformModules: Array.isArray(prev.platformModules) ? prev.platformModules : [],\n        realTimeMetrics: prev.realTimeMetrics || {}\n      }));\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    fetchBusinessData();\n  }, [fetchBusinessData]);\n\n  // 🔧 SAFE: Derived metrics with array safety checks\n  const derivedMetrics = {\n    activeEmployees: safeArrayFilter(businessData.employees, e => e.status === 'Active'),\n    totalClients: ((_businessData$clients = businessData.clients) === null || _businessData$clients === void 0 ? void 0 : _businessData$clients.length) || 0,\n    activeGuards: safeArrayFilter(businessData.employees, e => e.status === 'Active' && (e.role || '').toLowerCase().includes('guard')),\n    supervisors: safeArrayFilter(businessData.employees, e => e.status === 'Active' && (e.role || '').toLowerCase().includes('supervisor')),\n    monthlyRevenue: Array.isArray(businessData.clients) ? businessData.clients.reduce((sum, client) => sum + (client.monthly_revenue || 0), 0) : 0,\n    averageHourlyRate: (() => {\n      const activeEmp = safeArrayFilter(businessData.employees, e => e.status === 'Active' && e.hourlyRate);\n      return activeEmp.length > 0 ? activeEmp.reduce((sum, e) => sum + (e.hourlyRate || 0), 0) / activeEmp.length : 0;\n    })()\n  };\n  const refreshData = useCallback(async () => {\n    await fetchBusinessData();\n  }, [fetchBusinessData]);\n  return {\n    businessData,\n    isLoading,\n    error,\n    refreshData,\n    derivedMetrics,\n    // 🔧 SAFE: Helper methods for components\n    safeEmployees: Array.isArray(businessData.employees) ? businessData.employees : [],\n    safeClients: Array.isArray(businessData.clients) ? businessData.clients : [],\n    safeSites: Array.isArray(businessData.sites) ? businessData.sites : []\n  };\n};\n_s(useBusinessData, \"TQBSLkB/GrHjaR4GxRRKaZAHR9U=\");","map":{"version":3,"names":["useState","useEffect","useCallback","API_BASE","process","env","REACT_APP_API_URL","useBusinessData","_s","_businessData$clients","businessData","setBusinessData","employees","clients","sites","companyInfo","platformModules","realTimeMetrics","isLoading","setIsLoading","error","setError","safeArrayFilter","array","filterFn","Array","isArray","filter","fetchBusinessData","response","fetch","ok","Error","status","statusText","result","json","success","_result$data","_result$data2","_result$data3","_result$data4","_result$data5","_result$data6","safeData","data","summary","console","log","length","err","message","prev","derivedMetrics","activeEmployees","e","totalClients","activeGuards","role","toLowerCase","includes","supervisors","monthlyRevenue","reduce","sum","client","monthly_revenue","averageHourlyRate","activeEmp","hourlyRate","refreshData","safeEmployees","safeClients","safeSites"],"sources":["C:/Users/onetr/OneDrive/Desktop/universal-business-platform/universal-business-platform/frontend/src/hooks/useBusinessData.js"],"sourcesContent":["// src/hooks/useBusinessData.js\r\nimport { useState, useEffect, useCallback } from 'react';\r\n\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:3000';\r\n\r\nexport const useBusinessData = () => {\r\n  const [businessData, setBusinessData] = useState({\r\n    employees: [], // 🔧 FIX: Default to empty array\r\n    clients: [],   // 🔧 FIX: Default to empty array\r\n    sites: [],     // 🔧 FIX: Default to empty array\r\n    companyInfo: {},\r\n    platformModules: [],\r\n    realTimeMetrics: {}\r\n  });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // 🔧 SAFE: Helper function to ensure arrays exist\r\n  const safeArrayFilter = (array, filterFn) => {\r\n    return Array.isArray(array) ? array.filter(filterFn) : [];\r\n  };\r\n\r\n  const fetchBusinessData = useCallback(async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      \r\n      const response = await fetch(`${API_BASE}/api/business-data`);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (result.success) {\r\n        // 🔧 SAFE: Ensure all arrays exist with fallbacks\r\n        const safeData = {\r\n          employees: Array.isArray(result.data?.employees) ? result.data.employees : [],\r\n          clients: Array.isArray(result.data?.clients) ? result.data.clients : [],\r\n          sites: Array.isArray(result.data?.sites) ? result.data.sites : [],\r\n          companyInfo: result.data?.companyInfo || {},\r\n          platformModules: Array.isArray(result.data?.platformModules) ? result.data.platformModules : [],\r\n          realTimeMetrics: result.data?.realTimeMetrics || {},\r\n          summary: result.summary || {}\r\n        };\r\n        \r\n        setBusinessData(safeData);\r\n        console.log('✅ Business data loaded safely:', {\r\n          employees: safeData.employees.length,\r\n          clients: safeData.clients.length,\r\n          sites: safeData.sites.length\r\n        });\r\n      } else {\r\n        throw new Error(result.error || 'Failed to fetch business data');\r\n      }\r\n    } catch (err) {\r\n      console.error('❌ Business data fetch error:', err);\r\n      setError(err.message);\r\n      // 🔧 SAFE: Keep existing data structure even on error\r\n      setBusinessData(prev => ({\r\n        employees: Array.isArray(prev.employees) ? prev.employees : [],\r\n        clients: Array.isArray(prev.clients) ? prev.clients : [],\r\n        sites: Array.isArray(prev.sites) ? prev.sites : [],\r\n        companyInfo: prev.companyInfo || {},\r\n        platformModules: Array.isArray(prev.platformModules) ? prev.platformModules : [],\r\n        realTimeMetrics: prev.realTimeMetrics || {}\r\n      }));\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchBusinessData();\r\n  }, [fetchBusinessData]);\r\n\r\n  // 🔧 SAFE: Derived metrics with array safety checks\r\n  const derivedMetrics = {\r\n    activeEmployees: safeArrayFilter(businessData.employees, e => e.status === 'Active'),\r\n    totalClients: businessData.clients?.length || 0,\r\n    activeGuards: safeArrayFilter(businessData.employees, e => \r\n      e.status === 'Active' && (e.role || '').toLowerCase().includes('guard')\r\n    ),\r\n    supervisors: safeArrayFilter(businessData.employees, e => \r\n      e.status === 'Active' && (e.role || '').toLowerCase().includes('supervisor')\r\n    ),\r\n    monthlyRevenue: Array.isArray(businessData.clients) \r\n      ? businessData.clients.reduce((sum, client) => sum + (client.monthly_revenue || 0), 0)\r\n      : 0,\r\n    averageHourlyRate: (() => {\r\n      const activeEmp = safeArrayFilter(businessData.employees, e => e.status === 'Active' && e.hourlyRate);\r\n      return activeEmp.length > 0 \r\n        ? activeEmp.reduce((sum, e) => sum + (e.hourlyRate || 0), 0) / activeEmp.length \r\n        : 0;\r\n    })()\r\n  };\r\n\r\n  const refreshData = useCallback(async () => {\r\n    await fetchBusinessData();\r\n  }, [fetchBusinessData]);\r\n\r\n  return {\r\n    businessData,\r\n    isLoading,\r\n    error,\r\n    refreshData,\r\n    derivedMetrics,\r\n    // 🔧 SAFE: Helper methods for components\r\n    safeEmployees: Array.isArray(businessData.employees) ? businessData.employees : [],\r\n    safeClients: Array.isArray(businessData.clients) ? businessData.clients : [],\r\n    safeSites: Array.isArray(businessData.sites) ? businessData.sites : []\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}